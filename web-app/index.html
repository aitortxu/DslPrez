<!DOCTYPE html>
<html><head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>Groovy DSL.</title>
    <meta name="description" content="The powr of Groovy for DSL and USer Interaction in this presentration">
    <meta name="author" content="Corinne Krych, Sebastien Blanc, Fabrice Matrat">

    <link rel="shortcut icon" href="img/icon.ico" type="image/x-icon">

    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="img/grails.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="img/grails.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="img/grails.png">
    <link rel="apple-touch-icon-precomposed" href="img/grails.png">

    <script type="text/javascript" src="js/iscroll.js"></script>

    <link rel="stylesheet" href="css/codemirror.css">
    <link rel="stylesheet" href="css/eclipse.css">
    <script src="js/codemirror.js"></script>
    <script src="js/groovy.js"></script>
    <script src="js/groovy.js"></script>
    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/bootstrap-responsive.css" rel="stylesheet">


    <style type="text/css" media="all">

        .CodeMirror {
            border: 2px solid #eee;
            width: 90%;
            height: 95%;
            margin-left: 5%;
        }
        .CodeMirror-scroll {
            overflow-y: hidden;
            overflow-x: auto;
        }

        body,ul,li {
            font-family: 'PT Serif', georgia, serif;
            padding:0;
            margin:0;
            border:0;
            text-align: center;
        }

        body {
            font-family: 'PT Serif', georgia, serif;
            background: #ededeb url("img/bg.png") repeat 0 0;
            font-size:12px;
            -webkit-user-select:none;
            -webkit-text-size-adjust:none;
            font-family:helvetica;
        }

        #header {
            font-family: 'PT Serif', georgia, serif;
            position:absolute; z-index:2;
            top:0; left:0;
            width:100%;
            height:45px;
            line-height:45px;
            background-color: #3b4145;
            background-image: -moz-linear-gradient(top, #41484c, #31373a);
            background-image: -ms-linear-gradient(top, #41484c, #31373a);
            background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#41484c), to(#31373a));
            background-image: -webkit-linear-gradient(top, #41484c, #31373a);
            background-image: -o-linear-gradient(top, #41484c, #31373a);
            background-image: linear-gradient(top, #41484c, #31373a);
            background-repeat: repeat-x;
            filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#41484c', endColorstr='#31373a', GradientType=0);
            font-size:20px;
            text-align:center;
        }

        #header a {
            font-family: 'PT Serif', georgia, serif;
            color:#f3f3f3;
            text-decoration:none;
            font-weight:bold;
            text-shadow:0 -1px 0 rgba(0,0,0,0.5);
            width:100%;
            text-align:center;
        }


        #footer {
            font-family: 'PT Serif', georgia, serif;
            position:absolute; z-index:2;
            bottom:0; left:0;
            width:100%;
            height:48px;
            background-color: #3b4145;
            background-image: -moz-linear-gradient(top, #41484c, #31373a);
            background-image: -ms-linear-gradient(top, #41484c, #31373a);
            background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#41484c), to(#31373a));
            background-image: -webkit-linear-gradient(top, #41484c, #31373a);
            background-image: -o-linear-gradient(top, #41484c, #31373a);
            background-image: linear-gradient(top, #41484c, #31373a);
            background-repeat: repeat-x;
            filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#41484c', endColorstr='#31373a', GradientType=0);
            border-top:1px solid #444;
            text-align:center;
        }


        #footer a {
            color:#f3f3f3;
            text-decoration:none;
            font-weight:bold;
            text-shadow:0 -1px 0 rgba(0,0,0,0.5);
            width:100%;
            text-align:center;
        }

        #wrapper {
            font-family: 'PT Serif', georgia, serif;
            position:absolute; z-index:1;
            top:50px; bottom:48px; left:0;
            width:100%;
            overflow:auto;
        }

        .CodeMirror {
            border: 1px solid #eee;
            height: auto;
        }
        .CodeMirror-scroll {
            overflow-y: hidden;
            overflow-x: auto;
        }

        .code {
            font-size: 16px;
            font-family: monospace;
            white-space: pre-line;
            text-align: left;
        }
        .output {
            font-size: 25px;
            font-family: monospace;
            white-space: pre-line;
            text-align: left;
        }
        .code-color {
            color: blue;
        }

        .blur {
            font-size:75px;
            color: rgba(255, 255, 255, 0);
            text-shadow: 0 0 5px #000;
        }

    </style>
</head>
<body>

<div id="header" >
    <div style="float:left">
        <a href="http://groovy.codehaus.org">
            <table><tr><td style="vertical-align:middle;"><img  src="img/groovy.png" style="height:35px"/></td><td > </td></tr></table>
        </a>
    </div>
    <div style="display: inline-block; margin:0 auto;">
        <a href="https://github.com/corinnekrych/DslPrez">Groovy DSL and User Interaction</a>
    </div>
    <div style="float:right">
        <a href="http://grails.org">
            <table><tr><td style="vertical-align: middle; "> </td><td><img src="img/grails.png" style="height:35px"/></td></tr></table>
        </a>
    </div>
</div>
<div style="overflow: hidden;" id="wrapper">
<ul>

<li class="slide"  title="Start">

    <div class="container-narrow">
        <hr>

        <div class="jumbotron">
            <h1>Groovy DSL and User Interaction</h1>
        </div>

        <hr>
        <div class="row-fluid marketing">
            <div class="span6">
                <p><img width="20%" src="img/corinne_krych.png"/></p>
                <h4>Corinne Krych</h4>
            </div>

            <div class="span6">
                <p><img width="20%" src="img/sebi.jpg"/></p>
                <h4>Sébastien Blanc</h4>
            </div>
        </div>
        <hr>

        <div class="jumbotron">
            <p>to run this presentation: be full screen (F11)</p>
            <p>to submit the editor code to cloud foundry: ctrl S (command S on Mac)</p>
            <p>be careful using 1,2,3... it makes code snippet appears in the editor(focus must be inside editor)</p>
        </div>

        <hr>

        <div class="jumbotron">
            <p style="background:url(img/header-back.png);height:107px"><img src="img/logo-greach-2013.png"/></p>
        </div>

    </div>
</li>


<li class="slide" title="Corinne">
    <div class="container-narrow">
        <hr>

        <div class="jumbotron">
            <h1>Ladies first : Corinne</h1><br/>
            <img width="20%" src="img/corinne_krych.png"/><br/>
        </div>

        <hr>

        <div class="row-fluid marketing">
            <div class="span4">
                <a href="https://twitter.com/corinnekrych"><img src="img/twitter.png" /></a>
                <h4>@corinnekrych</h4>
            </div>
            <div class="span4">
                <a href="https://github.com/corinnekrych"><img src="img/github.png"/></a>
                <h4>https://github.com/corinnekrych</h4>
            </div>
            <div class="span4">
                <a href="mailto:corinnekrych@gmail.com"><img width="24px" src="img/gmail.png" ></a>
                <h4>corinnekrych@gmail.com</h4>
            </div>
        </div>
    </div>
</li>

<li class="slide" title="Sebastien">
    <div class="container-narrow">
        <hr>

        <div class="jumbotron">
            <h1>Sébastien : my geek friend</h1><br/>
            <img width="20%" src="img/sebi.jpg"/><br/>
        </div>

        <hr>

        <div class="row-fluid marketing">
            <div class="span4">
                <a href="https://twitter.com/sebi2706"><img src="img/twitter.png" /></a>
                <h4>@sebi2706</h4>
            </div>
            <div class="span4">
                <a href="https://github.com/corinnekrych"><img src="img/github.png"/></a>
                <h4>https://github.com/sebastienblanc</h4>
            </div>
            <div class="span4">
                <a href="mailto:scm.blanc@gmail.com"><img width="24px" src="img/gmail.png" ></a>
                <h4>scm.blanc@gmail.com</h4>
            </div>
        </div>
    </div>
</li>

<li class="slide" title="Seco">
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <h1>Amadeus Selling</h1> <h1>Platform Connect</h1><br/>
        </div>
        <hr>
        <div class="row-fluid marketing">
            <div class="span6">
                <img src="img/bookingfile.png" width="80%"/>
            </div>
            <div class="span6">
                <img src="img/cryptic.png" width="80%"/>
            </div>
        </div>
    </div>
</li>

<li class="slide" title="Booking File">
    <img src="img/bookingfile.png" width="80%"/>
</li>

<li class="slide" title="Cryptic">
    <img src="img/cryptic.png" width="80%"/>
</li>

<li class="slide" title="Productivity Suite">
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <br/>
            <h1>Productivity Suite</h1><br/>
            <br/>
        </div>
        <hr>
        <div class="row-fluid marketing">
            <div class="span4">
                <img src="img/smk.PNG" width="80%"/>
            </div>
            <div class="span4">
                <img src="img/simple_editor.png" width="80%"/>
            </div>
            <div class="span4">
                <img src="img/advanced_editor2.png" width="80%"/>
            </div>
        </div>
    </div>
</li>

<li class="slide" title="Smart Keys">
    <img src="img/smk.PNG" width="80%"/>
</li>

<li class="slide" title="Simple Editor">
    <img src="img/simple_editor.png" width="80%"/>
</li>

<li class="slide" title="Advanced Editor">
    <img src="img/advanced_editor2.png" width="80%"/>
</li>


<li class="slide" title="DSL Definition">
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <h1>WHAT IS A <b>DSL</b>?</h1><br/>
        </div>
        <hr>
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <p style="line-height: 150%;font-size: 35px"><strong>Domain-specific language</strong> (noun)</p>
                <p style="line-height: 150%;font-size: 30px" >a computer programming language of limited expressiveness focused on a particular domain</p>
                <h3>- Martin Fowler</h3>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<li class="slide" title="Computer Language">
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <pre style="font-size:16px;text-align:justify">
        10000110 10000000 11000000 00000101 10000110 10000000 11000000 00000101 10000110 10000000
        11000000 00000101 10000110 10000000 11000000 00000101 00000000 00000000 00000000 00010100
        00000000 00000000 00000000 00010100 10000110 10000000 11000000 00000101 10000110 10000000
        10000110 10000000 11000000 00000101 10000110 10000000 11000000 00000101 10000110 10000000
        11000000 00000101 10000110 10000000 11000000 00000101 00000000 00000000 00000000 00010100
        00000000 00000000 00000000 00010100 10000110 10000000 11000000 00000101 10000110 10000000
        10000110 10000000 11000000 00000101 10000110 10000000 11000000 00000101 10000110 10000000
        11000000 00000101 10000110 10000000 11000000 00000101 00000000 00000000 00000000 00010100
        00000000 00000000 00000000 00010100 10000110 10000000 11000000 00000101 10000110 10000000
        10000110 10000000 11000000 00000101 10000110 10000000 11000000 00000101 10000110 10000000
        11000000 00000101 10000110 10000000 11000000 00000101 00000000 00000000 00000000 00010100
        00000000 00000000 00000000 00010100 10000110 10000000 11000000 00000101 10000110 10000000
        10000110 10000000 11000000 00000101 10000110 10000000 11000000 00000101 10000110 10000000
        11000000 00000101 10000110 10000000 11000000 00000101 00000000 00000000 00000000 00010100
        00000000 00000000 00000000 00010100 10000110 10000000 11000000 00000101 10000110 10000000
        10000110 10000000 11000000 00000101 10000110 10000000 11000000 00000101 10000110 10000000
        11000000 00000101 10000110 10000000 11000000 00000101 00000000 00000000 00000000 00010100
        00000000 00000000 00000000 00010100 10000110 10000000 11000000 00000101 10000110 10000000
            </pre>
        </div>
        <hr>
    </div>
</li>

<li class="slide" title="Computer Programming Language">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                    <pre class="code" style="line-height: 150%;font-size: 25px">
    <b class="code-color">SELECT</b> Bride
    <b class="code-color">FROM</b> SingleWomen
    <b class="code-color">WHERE</b> FatherInLaw = 'Millionaire'
    <b class="code-color">AND</b> Count(Car) > 20

    <b class="code-color">SELECT</b> Cash, Car, BankBalance
    <b class="code-color">FROM</b> FatherInLaw

    <b class="code-color">UPDATE</b> MyBankAccout
    <b class="code-color">SET</b> MyBal = MyBal + FatherInLawBal

    <b class="code-color">INSERT INTO</b> MyCarShed
    <b class="code-color">VALUES</b>('BMW')
                    </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<li class="slide" title="Rubik Cube">
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <!-- http://openclipart.org/detail/164749/cube-of-rubik-by-sprint-->
            <img style="width:20%" src="img/cube_of_rubik_1.png"><br/>
        </div>
        <hr>
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <h1>RR U F B' RR F' B U RR</h1>
                    <pre class="code">
                    Terminology
                        F = front face
                        B = back face
                        R = right face
                        L = left face
                        U = up face
                        D = down face
                        A letter by itself means turn that face 90 degrees clockwise (eg. F).
                        A letter followed by an apostrophe means turn that face 90 degrees anti-clockwise (eg. F').
                    </pre>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<li class="slide" title="Boundaries">
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <br/>
            <h1 class="blur">Boundaries are blurry</h1><br/>
            <br/>
        </div>
        <hr>
        <div class="row-fluid marketing">
            <div class="span4">
                <h1>Mini Language</h1>
                <hr>
                <pre class="code">prepare tapas for starter</pre>
                <hr>
            </div>
            <div class="span4">
                <h1>Scripting</h1>
                <hr>
                <div> </div>
                <pre class="code">['tortilla', 'paella'].each{eat it}</pre>
                <hr>
            </div>
            <div class="span4">
                <h1>Fluent API</h1>
                <hr>
                <pre class="code">lunch.willBe 45.minutes.from.now</pre>
                <hr>
            </div>
        </div>
    </div>
</li>

<li class="slide" title="Ext. vs int.">
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <br/>
            <h1 >External vs Internal DSL</h1><br/>
            <br/>
        </div>
        <hr>
        <div class="row-fluid marketing">
            <div class="span6">
                <h1>External</h1>
                <img width="97%" src="img/pix.jpeg">
            </div>
            <div class="span6">
                <h1>Internal</h1>
                <pre style="text-align: left;white-space: pre;font-size: 16px">
<b style="color:#AF956F;">class</b> HelloSpock <b style="color:#AF956F;">extends</b> spock.lang.Specification {
    <b style="color:#AF956F;">def</b> <b style="color:#5D90CD;">"length of Spock's and his friends' names"</b>() {
        expect:
        name.size() == length

        where:
        name     | length
        <b style="color:#5D90CD;">"Spock"</b>  | <b style="color:#46A609;">5</b>
        <b style="color:#5D90CD;">"Kirk"</b>   | <b style="color:#46A609;">4</b>
        <b style="color:#5D90CD;">"Scotty"</b> | <b style="color:#46A609;">6</b>
    }
}
                </pre>
            </div>
        </div>
    </div>
</li>
<li class="slide" title="Groovy">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8" style="height:600px;width:100%;" id="wordcloud">
                <span data-weight="9">syntax sugar</span>
                <span data-weight="7">less punctuation</span>
                <span data-weight="5">scripting </span>
                <span data-weight="7">binding</span>
                <span data-weight="10">no getter setter</span>
                <span data-weight="7">map</span>
                <span data-weight="8">named parameters</span>
                <span data-weight="6">closure</span>
                <span data-weight="4">GString</span>
                <span data-weight="3">public visibility</span>
                <span data-weight="3">return statement optional</span>
                <span data-weight="7">groovy truth</span>
                <span data-weight="11">operator overloading</span>
                <span data-weight="4">GroovyMarkup</span>
                <span data-weight="7">method pointer</span>
                <span data-weight="11">runtime transformation</span>
                <span data-weight="9">MOP</span>
                <span data-weight="7">Expando</span>
                <span data-weight="7">Categories</span>
                <span data-weight="7">methodMissing</span>
                <span data-weight="12">command chaining</span>
                <span data-weight="7">compile time transformation</span>
                <span data-weight="7">AST transformation</span>
                <span data-weight="7">CST transformation</span>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>


<li class="slide" style="text-align: left" title="titi2">
    <textarea id="editor1" name="editor1">
// Configure the GroovyShell.
def shell = new GroovyShell()

///////////////////////
def surveyDSL = '''
'''
//////////////////////
// Run DSL script.
def result = shell.evaluate surveyDSL
    </textarea>
</li>

<li class="slide" style="text-align: left" title="output">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="output" id="output1">
                </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<li class="slide" style="text-align: left" title="editor2">
    <textarea id="editor2" name="editor2">
// Configure the GroovyShell.
def shell = new GroovyShell()

///////////////////////
def surveyDSL = '''
def ask(question) {
  println "question: $question"
}
ask "what is your name?"

'''
//////////////////////
// Run DSL script.
def result = shell.evaluate surveyDSL
    </textarea>
</li>

<li class="slide" style="text-align: left" title="output2">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="code" id="output2">
                </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<li class="slide" title="Command Chaining">
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <br/>
            <h1>Command chaining</h1><br/>
            <br/>
        </div>
        <hr>
    </div>
    <div class="row-fluid marketing">
        <div class="span2">
        </div>
        <div class="span8">
            <p style="line-height:150%; font-size:25px;font-style:italic"><strong>Method chaining</strong> is a common technique for invoking multiple method calls in object-oriented programming languages. Each method returns an object (possibly the current object itself), allowing the calls to be chained together in a single statement.</p>
            <div style="line-height:150%; font-size:20px;" class="general quote-author">- wikipedia</div>
        </div>
        <div class="span2">
        </div>
    </div>
</li>

<li class="slide" style="text-align: left" title="editor3">
    <textarea id="editor3" name="editor3">
abstract class SurveyScript extends Script {
  def ask(question) {
    println "question: $question"
  }
}
def compilerConfig = new CompilerConfiguration()
compilerConfig.scriptBaseClass = SurveyScript.class.name
def binding = new Binding()
// Configure the GroovyShell.
def shell = new GroovyShell(this.class.classLoader,
                            binding,
                            compilerConfig)
///////////////////////
def surveyDSL = '''
ask "what is your name?"
'''
//////////////////////
// Run DSL script.
shell.evaluate surveyDSL
    </textarea>
</li>


<li class="slide" style="text-align: left" title="output3">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="output" id="output3">
                </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<li class="slide" title="Command Chaining">
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <br/>
            <h1>Back to command chaining</h1><br/>
            <br/>
        </div>
        <hr>
    </div>
    <div class="row-fluid marketing">
        <div class="span1">
        </div>
        <div class="span5">
            <hr>
            <div style="line-height:150%;font-size:25px;text-align:left;">
                <div style="color:grey"> ask "question" into var</div>
                <div>    => ask(question).into(var)</div>
            </div>
            <hr>
        </div>
        <div class="span5">
            <hr>
            <div style="line-height:150%;font-size:25px;text-align:left;">
                <div style="color:grey">ask "question" assign to var</div>
                <div>    => ask("question").assign(to).var</div>
            </div>
            <hr>
        </div>
        <div class="span1">
        </div>
    </div>
</li>

<li class="slide" style="text-align: left" title="editor4">
    <textarea id="editor4" name="editor4">
abstract class SurveyScript extends Script {
  def i = 1
  def map = [:]

  def ask(question) {
    map["question$i"] = question
    return this
  }

  def into(variable) {
    map["variable$i"] = variable
    i++
  }

  def propertyMissing(def propertyName) {
    propertyName
  }

  def display(Map mapToDisplay) {
    mapToDisplay.eachWithIndex { key, value, index ->
      println "$key: $value"
      if (index % 2) {
        println "______________________________________\n"
      }
    }
  }
}

def compilerConfig = new CompilerConfiguration()
compilerConfig.scriptBaseClass = SurveyScript.class.name

def binding = new Binding()

// Configure the GroovyShell.
def shell = new GroovyShell(this.class.classLoader,
                            binding,
                            compilerConfig)

///////////////////////
def surveyDSL = '''
ask "what is your name?" into name
ask "what is your birthdate?" into date
display map
'''
//////////////////////
// Run DSL script.
shell.evaluate surveyDSL
    </textarea>
</li>

<li class="slide" style="text-align: left" title="output4">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="output" id="output4">
                </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<li class="slide" title="DSL Sequence">
    <div class="row-fluid marketing">
        <div class="span12">
            <img style="width:500px" src="img/dslsequence.png">
        </div>
    </div>
</li>

<li class="slide" style="text-align: left" title="editor5">
    <textarea id="editor5" name="editor5">
def compilerConfig = new CompilerConfiguration()
compilerConfig.scriptBaseClass = SurveyScript.class.name
def binding = new Binding()
// Configure the GroovyShell.
def shell = new GroovyShell(this.class.classLoader,
                            binding,
                            compilerConfig)

///////////////////////
def surveyDSL = '''
ask "what is your name?" assign to name
ask "what is your birthdate?" assign to date
display map
'''
//////////////////////
// Run DSL script.
shell.evaluate surveyDSL

abstract class SurveyScript extends Script {

  def i = 1;
  def map = [:]

  def ask(question) {
    [assign : { to ->
      [:].withDefault {variable ->
        map["question$i"] = question
        map["variable$i"] = variable
        i++
      }
    }]
  }

  def propertyMissing(def propertyName) {
    propertyName
  }

  def display(Map mapToDisplay) {
    mapToDisplay.eachWithIndex { key, value, index ->
      println "$key: $value"
      if (index % 2) {
        println "______________________________________\n"
      }
    }
  }
}
    </textarea>
</li>

<li class="slide" style="text-align: left" title="output5">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="output" id="output5">
                </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<li class="slide" title="DSL Sequence">
    <div class="row-fluid marketing">
        <div class="span12">
            <img src="img/ask.png" width="80%"/>
        </div>
    </div>
</li>

<li class="slide" style="text-align: left" title="editor6">
    <textarea id="editor6" name="editor6">
def getShell(binding) {
  def config = new CompilerConfiguration()
  config.addCompilationCustomizers(new SurveyCustomizer())
  config.scriptBaseClass = SurveyScript.name
  new GroovyShell(this.class.classLoader,
                  binding,
                  config)
}
def binding = new Binding()
def inputs = [:]
binding.setVariable("inputs", inputs)
def script = """
ask "what's your name?" assign to name
ask "First time in GGX?" assign to ggx
"""
//first evaluate should run only the first ask
getShell(binding).evaluate script
//second evaluate should run only the second ask2
getShell(binding).evaluate script


abstract class SurveyScript extends Script {
  def ask(question) {
    [assign : { to ->
      [:].withDefault {assignment ->
        inputs.question = question
        inputs.lastAssignment = assignment
        println "ask called\n --> counter: $inputs.counter \n" +
        "--> question: $question\n" +
        "--> variables: $inputs.lastAssignment\n" +
        "______________________________________\n"
        inputs.counter++
      }
    }]
  }

  def propertyMissing(String name) {
    name
  }

  //entry point method each time the script is called
  void dispatch() {
    if(!inputs.answerMap){
      inputs.answerMap = [:]
    }
    if(!inputs.counter){
      inputs.counter=0
    }
    inputs.answerMap[inputs.counter] =
      [variable:inputs.lastAssignment,
       question:inputs.question,
       answer:inputs.answer]
    invokeMethod()
  }

  def invokeMethod() {
    try {
      def method =
      this.class.getMethod("doStep_${inputs.counter}")
      method.invoke(this)
    }
    catch(NoSuchMethodException exp){
      inputs.finished = true
    }
  }
}

public class SurveyCustomizer extends CompilationCustomizer {
  def step = 0

  public SurveyCustomizer() {
    super(CompilePhase.CONVERSION);
  }

  @Override
  public void call(final SourceUnit source,
                   final GeneratorContext context,
                   final ClassNode classNode)
    throws CompilationFailedException {
    def methodCalls = []
    def ast = source.getAST();
    ast.classes.each {
      def myClassNode = it
      it.methods.each {
        if (it.code instanceof BlockStatement
          && it.name == "run") {
          it.code.statements.each {
            methodCalls << it
          }
          def result = new AstBuilder().buildFromCode {
            this.dispatch()
          }
          it.code = result[0];
        }
      }
      methodCalls.each {
        addStatement(it, myClassNode)
      }
    }
  }

  private def addStatement(ExpressionStatement exprStmt,
                           myClassNode) {
    BlockStatement methodCodeBlock = new BlockStatement()
    methodCodeBlock.addStatement(exprStmt)
    myClassNode.addMethod("doStep_" + step,
                          1,
                          null,
                          [] as Parameter[],
                          [] as ClassNode[],
                          methodCodeBlock)
    step++
  }
}
    </textarea>
</li>

<li class="slide" style="text-align: left" title="output6">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="output" id="output6">
                </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>


<li class="slide" title="DSL Sequence">
    <div class="row-fluid marketing">
        <div class="span12">
            <img src="img/when.png" width="80%"/>
        </div>
    </div>
</li>

<li class="slide" style="text-align: left" title="editor7">
    <textarea id="editor7" name="editor7">
def getShell(binding) {
  def config = new CompilerConfiguration()
  config.addCompilationCustomizers(new SurveyCustomizer())
  config.scriptBaseClass = SurveyScript.name
  new GroovyShell(this.class.classLoader,
                  binding,
                  config)
}
def inputs = [:]
def binding = new Binding("inputs": inputs,
                          "invokeNext": Boolean.TRUE)
def script = """
  ask "First time in GGX?" assign to ggx
  when (false) {
    ask "Are you DSL addicted?" assign to dsl
  }
"""
//first evaluate should run only the first ask
getShell(binding).evaluate script
//second evaluate should run only the second ask2
getShell(binding).evaluate script


abstract class SurveyScript extends Script {
  def ask(question) {
    [assign : { to ->
      [:].withDefault {assignment ->
        inputs.question = question
        inputs.lastAssignment = assignment
        println "ask called\n --> with counter: $inputs.counter \n" +
                "--> question: $inputs.question\n" +
                "--> stored variables: $inputs.lastAssignment\n" +
                "______________________________________\n"
        inputs.counter++
        invokeNext = Boolean.FALSE
      }
    }]
  }

  def when(Boolean exp, Closure closure) {
    if(exp) {
      closure()
    }  else {
      inputs.counter++
    }
  }

  def propertyMissing(String name) {
    name
  }

  //entry point method each time the script is called
  void dispatch() {

    if(!inputs.answerMap) {
      inputs.answerMap = [:]
    }
    if(!inputs.counter) {
      inputs.counter=0
    }
    inputs.answerMap[inputs.counter] = [variable:inputs.lastAssignment,
                                        question:inputs.question,
                                        answer:inputs.answer]
                                        invokeMethod()
  }

  def invokeMethod() {
    try {
      def methodToInvoke  = this.class.getMethod("doStep_${inputs.counter}")
      methodToInvoke.invoke(this)
      if (invokeNext) {
        invokeMethod()
      }
    }
    catch(NoSuchMethodException exp) {
      inputs.finished = true
    }
  }
}

public class SurveyCustomizer extends CompilationCustomizer {
  def step = 0

  public SurveyCustomizer() {
    super(CompilePhase.CONVERSION);
  }

  @Override
  public void call(final SourceUnit source,
                   final GeneratorContext context,
                   final ClassNode classNode)
    throws CompilationFailedException {
    def methodCalls = []
    def ast = source.getAST()
    ast.classes.each {
      def myClassNode = it
      it.methods.each {
        if (it.code instanceof BlockStatement && it.name == "run") {
          it.code.statements.each {
            methodCalls << it
          }
          def result = new AstBuilder().buildFromCode {
            this.dispatch()
          }
          it.code = result[0];
        }
      }
      methodCalls.each {
        def booleans = []
        addStatement(it, myClassNode, booleans)
      }
    }
  }

  private def addStatement(ExpressionStatement exprStmt, myClassNode, booleans) {
    if (exprStmt.expression.hasProperty("method")) {
      booleans << exprStmt.expression.arguments.expressions[0]
      def whenClosure = exprStmt.expression.arguments.expressions[1]
      whenClosure.code.statements.each {
        addStatement(it, myClassNode, booleans)
      }
      if (booleans.size > 0) {
        booleans.remove(booleans.size-1)
      }
    } else {
      BlockStatement methodCodeBlock = new BlockStatement()
      if (booleans.size > 0) {
        def newWhenExpression = getWhenExpression(exprStmt, booleans)
        methodCodeBlock.addStatement(newWhenExpression)
      } else {
        methodCodeBlock.addStatement(exprStmt)
      }
      myClassNode.addMethod("doStep_" + step,
                            1,
                            null,
                            [] as Parameter[],
                            [] as ClassNode[],
                            methodCodeBlock)
      step++
    }
    step
  }

  private ExpressionStatement getWhenExpression(ExpressionStatement exprStmt, booleans) {
    BlockStatement block = new BlockStatement()
    block.addStatement(exprStmt)
    ClosureExpression closureExpression = new ClosureExpression(null, block)

    Expression binaryExpr = booleans[0];
    for (def i = 0; i < booleans.size - 1; i++) {
      binaryExpr = new BinaryExpression(binaryExpr,
      Token.newSymbol("&&", 0, 0), booleans[i + 1])
    }
    new ExpressionStatement(new MethodCallExpression(
                            new VariableExpression("this"),
                            new ConstantExpression("when"),
                            new ArgumentListExpression([binaryExpr, closureExpression])))
  }
}
    </textarea>
</li>

<li class="slide" style="text-align: left" title="output7">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="output" id="output7">
                </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<li class="slide" style="text-align: left" title="editor8">
    <textarea id="editor8" name="editor8">
ask "What's your name?" assign to name
ask name + ", why did you come to Greach?" assign to why
ask "Is this Groovy DSL a great talk?" assign to dsl
when (dsl == "yes") {
  ask "HTML5 Hands-on this afternoon?" assign to html5
  when (html5 == "yes") {
    ask "With the 3musket33rs ?" assign to us
  }
}
ask "Would you come back?" assign to comeback
    </textarea>
</li>


<li class="slide" style="text-align: left" title="output8">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre id="output8">
                <pre style="font-size: 22px;font-family: monospace;line-height: 120%" id="scriptContent"></pre>
                <label style="font-size: 22px;font-family: monospace;line-height: 120%" for="answer" id="displayQuestion"></label>
                <input class="input-medium search-query" type="text" id="answer"/>
                <br style="line-height: 60%"/>
                <button class="btn" id="submitButton" name="Run">Next</button>
                </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>


<li class="slide" style="text-align: left" title="output8bis">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre style="font-size: 30px;font-family: monospace;line-height: 120%" class="output" id="output8bis">
                </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>


<li class="slide" title="References">
    <div class="container-narrow">
        <hr>

        <div style="text-align: center" class="jumbotron">
            <img width="20%" src="img/rivierargug.png"/><br/>
        </div>

        <hr>

        <div  class="row-fluid marketing">
            <div class="span1">
            </div>
            <div class="span5">
                <div style="line-height: 150%;font-size:30px;font-weight:bold">Like the presentation format?</div>
                <div id="technologies" style="line-height: 150%;font-size:30px;"></div>

                <div style="line-height: 150%;font-size:30px;font-weight:bold">Curious about code?</div>
                <a href="https://github.com/corinnekrych/DslPrez" style="line-height: 150%;font-size:20px;">https://github.com/corinnekrych/DslPrez</a>

                <div style="line-height: 150%;font-size:30px;font-weight:bold">Want to play with it?</div>
                <a href='http://dslprez.cloudfoundry.com' style="line-height: 150%;font-size:20px;">http://dslprez.cloudfoundry.com</a>
            </div>
            <div class="span5">
                <div style="line-height: 150%;font-size:30px;font-weight:bold">Special Thanks</div>
                <div style="line-height: 150%;font-size:20px;">Fabrice Matrat</div>
                <div style="line-height: 150%;font-size:30px;font-weight:bold">References</div>
                <div style="line-height: 150%;font-size:20px;">Domain-Specific Languages</div>
                <div style="line-height: 150%;font-size:20px;font-style:italic">Martin Fowler, with Rebecca Parsons</div>
                <div style="line-height: 150%;font-size:20px;">Groovy for Domain-Specific Languages  </div>
                <div style="line-height: 150%;font-size:20px;font-style:italic">Fergal Dearle</div>
                <div style="line-height: 150%;font-size:20px;">Groovy in Action</div>
                <div style="line-height: 150%;font-size:20px;font-style:italic">Guillaume Laforge, Paul King, Jon Skeet </div>
            </div>
            <div class="span1">
            </div>
        </div>
    </div>
</li>

</ul>
</div>
<div id="footer">
    <div style="float:left;">
        <a id="previous">
            <table><tr><td style="vertical-align:middle;"><img  src="img/previous.png" style="height:40px"/></td><td id="previous-title"> Previous</td></tr></table>
        </a>
    </div>
    <div style="display: inline-block; margin:0 auto;">
        <a id="current" style="font-size:20px;">Groovy DSL and User Interaction</a>
    </div>
    <div style="float:right;">
        <a id="next">
            <table><tr><td id="next-title" style="vertical-align: middle; ">Next</td><td><img src="img/next.png" style="height:40px"/></td></tr></table>
        </a>
    </div>
</div>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>

<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
<!--[if lt IE 9]>
<script src="js/html5.js">
</script>
<![endif]-->
<script src="js/bootstrap.js"></script>


<script src="js/editor.js"></script>
<script>
function submitForm(input, output) {
    //var url = "http://dslprez.cloudfoundry.com/console/execute?=";
    var url = "http://localhost:8080/DslPrez/console/execute?=";
    $.post(url, {
        content : input
    }, function(data) {
        var value = "";
        if (data.stacktrace === "" || data.stacktrace.buffer !== undefined) {
            value = data.result;
        } else {
            value = data.stacktrace;
        }
        $(output).text(value);
        $('#next').click();
    });
}



    var editor1 = new dslPrez.editor("editor1");
    var keymap = {
        "1" : function() {
            var value = "def ask(question) {\n"
                    +"    println \"question: $question\"\n"
                    +"}\n"
                    +"ask \"what is your name?\"\n";
            editor1.replaceRange(value, {line: 5, ch: 0});
        },
        "Ctrl-S" : function() {
            var value = editor1.getValue();
            submitForm(value, "#output1");
        }
    };
    editor1.addKeyMap(keymap);
    editor1.focus();

    var editor2 = new dslPrez.editor("editor2");
    var keymap2 = {
        "Ctrl-S" :function() {
            var value = editor2.getValue();
            value += "import groovy.lang.Script;\nimport org.codehaus.groovy.control.CompilerConfiguration\n";
            submitForm(value, "#output2");
        },
        "1": function() {
            var value = "abstract class SurveyScript extends Script {\n"
                + "  def ask = {question -> println \"question: $question\" }\n"
                + "}\n";
            editor2.replaceRange(value, {line: 1, ch: 0});
        },
        "2": function() {
            editor2.removeLine(8);
            editor2.removeLine(8);
            editor2.removeLine(8);
        },
        "3": function() {
            var value = "def compilerConfig = new CompilerConfiguration()\n"
                + "compilerConfig.scriptBaseClass = SurveyScript.class.name\n"
                + "def binding = new Binding()\n";
            editor2.removeLine(5);
            editor2.replaceRange(value, {line: 4, ch: 0});
        },
        "4": function() {
            editor2.removeLine(7);
            var value = "" +
                    "def shell = new GroovyShell(this.class.classLoader,\n" +
                    "                            binding,\n" +
                    "                            compilerConfig)\n";
            editor2.replaceRange(value, {line: 7, ch: 0});
        }
    };

    editor2.addKeyMap(keymap2);
    editor2.focus();

    var editor3 = new dslPrez.editor("editor3");
    var keymap3 = {
        "Ctrl-S": function() {
            var value = editor3.getValue();
            value += "import groovy.lang.Script;\nimport org.codehaus.groovy.control.CompilerConfiguration\n";
            submitForm(value, "#output3");
        },
        "1": function() {
            var value = "ask \"what is your name?\" into name\n"
                    + "ask \"what is your birthdate?\" into date\n";
            editor3.removeLine(14);
            editor3.replaceRange(value, {line: 14, ch: 0});
        },
        "2": function() {
            var value = "    return this\n";
            editor3.replaceRange(value, {line: 3, ch: 0});
        },
        "3": function() {
            var value = "  def into(variable) {\n" + "  }\n";
            editor3.replaceRange(value, {line: 5, ch: 0});
        },
        "4": function() {
            var value = "  def map = [:]\n";
            editor3.replaceRange(value, {line: 1, ch: 0});
        },
        "5": function() {
            var value = "  def i = 1;\n";
            editor3.replaceRange(value, {line: 1, ch: 0});
            editor3.removeLine(5);
            value = "    map[\"question$i\"] = question\n";
            editor3.replaceRange(value, {line: 4, ch: 0});
            value = "    map[\"variable$i\"] = variable\n    i++\n";
            editor3.replaceRange(value, {line: 8, ch: 0});
        },
        "6": function() {
            var value = "  def propertyMissing(def propertyName) {\n"
                    + "    propertyName\n" + "  }\n  def display(Map mapToDisplay) {\n"
                    + "    mapToDisplay.eachWithIndex { key, value, index ->\n"
                    + "      println \"$key: $value\"\n"
                    + "      if (index % 2) { println \"______________________\\n\""
                    + "  }\n"
                    + "    }\n"
                    +"  }\n";
            editor3.replaceRange(value, {line: 11, ch: 0});
            value = "display map\n";
            editor3.replaceRange(value, {line: 32, ch: 0});
        }
    };
    editor3.addKeyMap(keymap3);
    editor3.focus();

    var editor4 = new dslPrez.editor("editor4");
    var keymap4 = {
        "Ctrl-S": function() {
            var value = editor4.getValue();
            value += "import groovy.lang.Script;\nimport org.codehaus.groovy.control.CompilerConfiguration\n";
            submitForm(value, "#output4");
        },
        "1": function() {
            editor4.removeLine(40);
            editor4.removeLine(40);
            var value = "ask \"what is your name?\" assign to name\nask \"what is your birthdate?\" assign to date\n";
            editor4.replaceRange(value, {line: 40, ch: 0});
        },
        "2": function() {
            editor4.removeLine(9);
            editor4.removeLine(9);
            editor4.removeLine(9);
            editor4.removeLine(9);
            var value = "  def assign(to) {\n  }\n";
            editor4.replaceRange(value, {line: 9, ch: 0});
        },
        "3": function() {
            var value = "    [:].withDefault { }\n";
            editor4.replaceRange(value, {line: 10, ch: 0});
        },
        "4": function() {
            editor4.removeLine(10);
            var value = "    [:].withDefault { variable ->\n      map[\"variable$j\"] = variable\n      j++\n    }\n";
            editor4.replaceRange(value, {line: 10, ch: 0});
            value = "  def j = 1\n";
            editor4.replaceRange(value, {line: 2, ch: 0});
            value = "    i++\n";
            editor4.replaceRange(value, {line: 7, ch: 0});
        }
    };

    editor4.addKeyMap(keymap4);


    var editor5 = new dslPrez.editor("editor5");
    var keymap5 = {
        "Ctrl-S": function() {
            var value = editor5.getValue();
            value = "import groovy.lang.Script;\nimport org.codehaus.groovy.control.CompilerConfiguration\n"
                    +"import org.codehaus.groovy.ast.*\n"
                    +"import org.codehaus.groovy.ast.expr.*\n"
                    +"import org.codehaus.groovy.ast.stmt.*\n"
                    +"import org.codehaus.groovy.classgen.GeneratorContext\n"
                    +"import org.codehaus.groovy.control.CompilationFailedException\n"
                    +"import org.codehaus.groovy.control.CompilePhase\n"
                    +"import org.codehaus.groovy.control.CompilerConfiguration\n"
                    +"import org.codehaus.groovy.control.SourceUnit\n"
                    +"import org.codehaus.groovy.control.customizers.*\n"
                    +"import org.codehaus.groovy.ast.builder.AstBuilder\n"
                    +"import org.codehaus.groovy.syntax.Token\n"
                    +"import org.codehaus.groovy.syntax.Types\n"
                    +"import static org.objectweb.asm.Opcodes.ACC_PUBLIC\n" + value;
            submitForm(value, "#output5");
        },
        "1": function() {
            var value = "binding.setVariable(\"whichMeal\", \"What would you like to have for lunch?\")\n";
            editor5.replaceRange(value, {line: 4, ch: 0});
        },
        "2": function() {
            var value = "ask whichMeal assign to meal\n";
            editor5.replaceRange(value, {line: 11, ch: 0});
        }
    };

    editor5.addKeyMap(keymap5);

    var editor6 = new dslPrez.editor("editor6");
    var keymap6 = {
        "Ctrl-S": function() {
            var value = editor6.getValue();
            value = "import groovy.lang.Script;\nimport org.codehaus.groovy.control.CompilerConfiguration\n"
                    +"import org.codehaus.groovy.ast.*\n"
                    +"import org.codehaus.groovy.ast.expr.*\n"
                    +"import org.codehaus.groovy.ast.stmt.*\n"
                    +"import org.codehaus.groovy.classgen.GeneratorContext\n"
                    +"import org.codehaus.groovy.control.CompilationFailedException\n"
                    +"import org.codehaus.groovy.control.CompilePhase\n"
                    +"import org.codehaus.groovy.control.CompilerConfiguration\n"
                    +"import org.codehaus.groovy.control.SourceUnit\n"
                    +"import org.codehaus.groovy.control.customizers.*\n"
                    +"import org.codehaus.groovy.ast.builder.AstBuilder\n"
                    +"import org.codehaus.groovy.syntax.Token\n"
                    +"import org.codehaus.groovy.syntax.Types\n"
                    +"import static org.objectweb.asm.Opcodes.ACC_PUBLIC\n" + value;
            submitForm(value, "#output6");
        }
    };

    editor6.addKeyMap(keymap6);


    var editor7 = new dslPrez.editor("editor7");
    var keymap7 = {
        "Ctrl-S": function() {
            var value = editor7.getValue();
            value = "import groovy.lang.Script;\nimport org.codehaus.groovy.control.CompilerConfiguration\n"
                    +"import org.codehaus.groovy.ast.*\n"
                    +"import org.codehaus.groovy.ast.expr.*\n"
                    +"import org.codehaus.groovy.ast.stmt.*\n"
                    +"import org.codehaus.groovy.classgen.GeneratorContext\n"
                    +"import org.codehaus.groovy.control.CompilationFailedException\n"
                    +"import org.codehaus.groovy.control.CompilePhase\n"
                    +"import org.codehaus.groovy.control.CompilerConfiguration\n"
                    +"import org.codehaus.groovy.control.SourceUnit\n"
                    +"import org.codehaus.groovy.control.customizers.*\n"
                    +"import org.codehaus.groovy.ast.builder.AstBuilder\n"
                    +"import org.codehaus.groovy.syntax.Token\n"
                    +"import org.codehaus.groovy.syntax.Types\n"
                    +"import static org.objectweb.asm.Opcodes.ACC_PUBLIC\n" + value;
            submitForm(value, "#output7");
        }
    };

    editor7.addKeyMap(keymap7);

    var editor8 = new dslPrez.editor("editor8");
    var keymap8 = {
        "Ctrl-S": function() {
            var value = editor8.getValue();
            var title = $('#titleCreate').val();
            submitCreateForm(title, value, "#output8");
        }
    };

    editor8.addKeyMap(keymap8);

    function submitCreateForm(title, input, output) {
        var url = "http://localhost:8080/DslPrez/survey/create?=";
        //var url = "http://dslprez.cloudfoundry.com/survey/create?=";
        $.post(url, {
            title:"myScript", content:input
        },function (data) {
            $("#displayQuestion").removeData();
            $('.displayAnswer').remove();
            $(".surveystart").show();
            $("#displayQuestion").data('scriptId', data.id);
            $("#displayQuestion").data('scriptContent', data.content);
            $('#scriptContent').text(data.content);
            $('#submitButton').click();
            $('#next').click();
        });
    }

$('#submitButton').bind('click', function() {
    var answer = $('#answer').val();
    $('#answer').val('');
    var answerMap = $("#displayQuestion").data('answerMap');
    var question = $("#displayQuestion").data('question');
    var scriptId = $("#displayQuestion").data('scriptId');
    var counter = $("#displayQuestion").data('counter');
    var lastAssignment = $("#displayQuestion").data('lastAssignment');
    if (answerMap)
        answerMap[counter] = {variable: lastAssignment, question: question, answer:answer};
    var stringAnswerMap = JSON.stringify(answerMap);
    var url = "http://localhost:8080/DslPrez/survey/run?=";
    //var url = "http://dslprez.cloudfoundry.com/survey/run?=";

    $.post(url, {
        scriptId:scriptId, question: question, lastAssignment:lastAssignment, counter:counter, answer:answer, answerMap:stringAnswerMap
    }, function(data) {

        var answerMap = data.answerMap;
        var counter = data.counter;
        var question = data.question;
        var lastAssignment = data.lastAssignment;
        $("#displayQuestion").data('answerMap', answerMap);
        $("#displayQuestion").data('question', question);
        $("#displayQuestion").data('counter', counter);
        $("#displayQuestion").data('lastAssignment', lastAssignment);
        if(data.finished==true) {
            $(".surveystart").hide();
            for(var index = 1; index <= counter;index++)  {
                if (answerMap[index]) {
                    var output8Value = '<div class="displayAnswer">' + answerMap[index].question + ' ' + answerMap[index].answer + '</div>';
                    $("#output8bis").append(output8Value);
                }
            }
            $('#next').click();
        } else {
            $("#displayQuestion").text(data.question);
        }
    });
});



</script>

<script src="js/jcloud.js"></script>


<script src="js/jquery.airport-1.1.source.js"></script>

<script type="text/javascript">
    $("#technologies").airport([ 'Twitter Bootstrap', 'iScroll', 'jCloud', 'jQuery-airport', 'grails', 'Code Mirror', 'jQuery' ]);
</script>


<script src="js/slide.js"></script>

<script type="text/javascript">

    var myScroll;
    function loaded() {
        myScroll = new iScroll('wrapper', {});
        myScroll.options.onBeforeScrollStart = function(e) {
            var target = e.target;

            while (target.nodeType != 1) target = target.parentNode;
            if (target.tagName != 'SELECT' && target.tagName != 'INPUT' && target.tagName != 'TEXTAREA'){
                e.preventDefault();
            }
        }
    }

    document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false);

    /* * * * * * * *
     *
     * Use this for high compatibility (iDevice + Android)
     *
     */
    document.addEventListener('DOMContentLoaded', function () { setTimeout(loaded, 200); }, false);
    /*
     * * * * * * * */


    /* * * * * * * *
     *
     * Use this for iDevice only
     *
     */
    //document.addEventListener('DOMContentLoaded', loaded, false);
    /*
     * * * * * * * */


    /* * * * * * * *
     *
     * Use this if nothing else works
     *
     */
    //window.addEventListener('load', setTimeout(function () { loaded(); }, 200), false);
    /*
     * * * * * * * */

</script>



</body>
</html>