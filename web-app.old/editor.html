<!doctype html>


<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Groovy DSL from real life exemple</title>
    <meta name="author" content="Corinne Krych, Sebastien Blanc" />

</head>

<body >

  <div class="step slide" id="editor" data-x="1500" data-y="0">package gr8conf
def binding = new Binding()

binding.answers = [1:'male', 2:'sebastien', 3: 'yes']

binding.index = 1;
binding.ask = {it->
  println "$it"
  binding.answer = binding.answers[binding.index] 
  binding.index++
  println ""+binding.answer
}

binding.when = {booleanExp, closure->
	if (booleanExp) {
	  closure()}
}

shell = new GroovyShell(binding)

shell.evaluate("""

ask "Are you male or female?"

when (answer == "male") {
  ask "What is your firstname, man?"
  when (answer == "sebastien") {
    ask "Are you a groovy developer"
  }
}

when answer == "female", {
  ask "Could I have your firstname please?"
}

""")</div>
  <style type="text/css" media="screen">
    #editor { 
        overflow: hidden;
        padding:0px;
        position: absolute;
        width:1024px;
        height:700px;
        line-height: 25px;
        font-size: 20px;
	text-shadow: 0 0px 0px #000;
    }
  </style>    
<script src="js/ace-uncompressed-noconflict.js" type="text/javascript" charset="utf-8"></script>
<script>
window.onload = function() {
    editor = ace.edit("editor");
    editor.setTheme("ace/theme/clouds");
    editor.getSession().setMode("ace/mode/groovy");

    var commands = editor.commands;

    commands.addCommand({
      name: "save",
      bindKey: {
      win: "Ctrl-S",
      mac: "Command-S",
      sender: "editor"
      },
      exec: function() {
      var value = editor.getSession().getValue();
      value = value.replace(/\n/g,"%0D").replace(/\r/g,""); 
      submitForm(value);
      }
    });
     
};
function submitForm(content)
{ 
    var xhr; 
    try {  
    	xhr = new XMLHttpRequest();  
    } catch (e3) {  
    	xhr = false;   
    }
 
    xhr.onreadystatechange  = function() { 
       if(xhr.readyState  == 4)
       {
        if(xhr.status  == 200) 
            document.ajax.dyn="Received:"  + xhr.responseText; 
        else 
            document.ajax.dyn="Error code " + xhr.status;
        }
    }; 
   var url = "http://localhost:8080/DslPrez/console/execute" + "?content=" + content;
   xhr.open( "POST", url,  true); 
   xhr.send(null);    
} 
</script>

</body>
</html>

